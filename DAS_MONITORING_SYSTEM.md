# üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ DAS –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏

## üìã –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã #3
**–ü—Ä–æ–±–ª–µ–º–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ DAS API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ compressed NFT

**–†–µ—à–µ–Ω–∏–µ:** –ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å background jobs –∏ webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

### 1. **IndexingMonitorService** - –û—Å–Ω–æ–≤–Ω–æ–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
```javascript
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ DAS –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
- startMonitoring() - –∑–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏
- checkDASIndexing() - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤ DAS API  
- Background jobs - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫
- Event-driven —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
```

### 2. **WebhookNotifierService** - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
```javascript
// –°–∏—Å—Ç–µ–º–∞ webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- registerWebhook() - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è endpoints
- notifyEvent() - –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- HMAC –ø–æ–¥–ø–∏—Å—å –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- Retry –ª–æ–≥–∏–∫–∞ —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º back-off
```

### 3. **API Endpoints** - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
```javascript
// REST API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º
GET /api/mint/monitoring/stats
GET /api/mint/monitoring/active
POST /api/mint/webhooks
DELETE /api/mint/webhooks/:id
```

---

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å:
```
1. –ú–∏–Ω—Ç NFT ‚úÖ
2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ üöÄ
3. Background –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫ üîÑ
4. DAS API –ø—Ä–æ–≤–µ—Ä–∫–∏ (—Å retry) üîç
5. Webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö üì°
6. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ ‚úÖ
```

### Timeline –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏:
- **0-30 —Å–µ–∫—É–Ω–¥**: –ë–ª–æ–∫—á–µ–π–Ω –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
- **30 —Å–µ–∫—É–Ω–¥ - 5 –º–∏–Ω—É—Ç**: –ë—ã—Å—Ç—Ä–∞—è DAS –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è  
- **5-20 –º–∏–Ω—É—Ç**: –ü–æ–ª–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è + Phantom –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å
- **20+ –º–∏–Ω—É—Ç**: –¢–∞–π–º–∞—É—Ç (–Ω–æ NFT –º–æ–∂–µ—Ç –ø–æ—è–≤–∏—Ç—å—Å—è –ø–æ–∑–∂–µ)

---

## üõ†Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```bash
# DAS API (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)
DAS_API_URL=https://rpc.helius.xyz/?api-key=YOUR_API_KEY
DAS_API_KEY=YOUR_HELIUS_API_KEY

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
MONITORING_INTERVAL_MS=30000    # 30 —Å–µ–∫—É–Ω–¥
MONITORING_MAX_RETRIES=40       # 20 –º–∏–Ω—É—Ç –º–∞–∫—Å–∏–º—É–º
WEBHOOK_RETRY_ATTEMPTS=3        # Retry webhooks
```

### 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫:
```javascript
// –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –º–∏–Ω—Ç–∏–Ω–≥–∞
if (result.success && result.assetId) {
  monitor.startMonitoring(operationId, result.assetId, metadata);
}
```

### 3. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è webhook:
```bash
POST /api/mint/webhooks
{
  "url": "https://yourapp.com/webhook",
  "events": ["indexingCompleted", "indexingTimeout"],
  "secret": "your-webhook-secret"
}
```

---

## üìä API Endpoints

### **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
```bash
# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
GET /api/mint/monitoring/stats

# –ê–∫—Ç–∏–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
GET /api/mint/monitoring/active  

# –°—Ç–∞—Ç—É—Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
GET /api/mint/monitoring/{operationId}

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
POST /api/mint/monitoring/{operationId}/stop
```

### **Webhooks:**
```bash
# –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è webhook
POST /api/mint/webhooks
{
  "url": "https://example.com/webhook",
  "events": ["indexingCompleted", "indexingTimeout", "indexingError"],
  "headers": {"Authorization": "Bearer token"},
  "secret": "webhook-secret"
}

# –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö webhooks
GET /api/mint/webhooks

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ webhook
POST /api/mint/webhooks/{id}/test

# –£–¥–∞–ª–µ–Ω–∏–µ webhook
DELETE /api/mint/webhooks/{id}
```

---

## üîî Webhook –°–æ–±—ã—Ç–∏—è

### **indexingCompleted** - NFT –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω
```json
{
  "event": "indexingCompleted",
  "timestamp": "2024-01-01T12:00:00Z",
  "data": {
    "operationId": "abc-123",
    "assetId": "xyz-789",
    "totalTime": 300000,
    "attempts": 5,
    "result": { /* DAS asset data */ }
  }
}
```

### **indexingTimeout** - –¢–∞–π–º–∞—É—Ç –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
```json
{
  "event": "indexingTimeout", 
  "timestamp": "2024-01-01T12:20:00Z",
  "data": {
    "operationId": "abc-123",
    "assetId": "xyz-789", 
    "totalTime": 1200000,
    "attempts": 40,
    "recommendation": "NFT –º–æ–∂–µ—Ç –ø–æ—è–≤–∏—Ç—å—Å—è –≤ –∫–æ—à–µ–ª—å–∫–µ –≤ —Ç–µ—á–µ–Ω–∏–µ 30-60 –º–∏–Ω—É—Ç"
  }
}
```

### **indexingError** - –û—à–∏–±–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
```json
{
  "event": "indexingError",
  "timestamp": "2024-01-01T12:05:00Z", 
  "data": {
    "operationId": "abc-123",
    "assetId": "xyz-789",
    "error": "DAS API unavailable",
    "attempts": 10
  }
}
```

---

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã:
```json
{
  "success": true,
  "data": {
    "totalMonitored": 150,
    "successfullyIndexed": 142,
    "timeouts": 6,
    "errors": 2,
    "activeJobs": 3,
    "averageIndexingTimeMinutes": 8.5,
    "isRunning": true
  }
}
```

### –ê–∫—Ç–∏–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:
```json
{
  "success": true,
  "data": {
    "total": 3,
    "operations": [
      {
        "operationId": "op-123",
        "assetId": "asset-456", 
        "status": "monitoring",
        "attempts": 5,
        "elapsed": 150000,
        "metadata": {
          "collection": "My Collection",
          "nftName": "Cool NFT #123"
        }
      }
    ]
  }
}
```

---

## üîß –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –æ—Ç–ª–∞–¥–∫–∞

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:
```bash
curl GET /api/mint/monitoring/stats
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤:
```bash
# –ü–æ–∏—Å–∫ –≤ –ª–æ–≥–∞—Ö —Å–µ—Ä–≤–µ—Ä–∞:
[Indexing Monitor] ‚úÖ –ù–∞—á–∞—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ operation
[Indexing Monitor] üîÑ –ü—Ä–æ–≤–µ—Ä—è–µ–º 3 –∞–∫—Ç–∏–≤–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
[Indexing Monitor] ‚úÖ op-123 —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω
```

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ webhook:
```bash
curl -X POST /api/mint/webhooks/{webhook-id}/test
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏:
```bash
curl GET /api/mint/monitoring/{operation-id}
```

---

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### Webhook –ø–æ–¥–ø–∏—Å–∏:
- **HMAC SHA-256** –ø–æ–¥–ø–∏—Å—å –∫–∞–∂–¥–æ–≥–æ webhook
- **Header**: `X-PEcoin-Signature: sha256=abc123...`
- **–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è**: –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ø–æ–¥–ø–∏—Å—å –Ω–∞ –≤–∞—à–µ–π —Å—Ç–æ—Ä–æ–Ω–µ

### –ü—Ä–∏–º–µ—Ä –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏:
```javascript
const crypto = require('crypto');

function verifyWebhook(payload, signature, secret) {
  const expected = crypto
    .createHmac('sha256', secret)
    .update(payload)
    .digest('hex');
    
  return `sha256=${expected}` === signature;
}
```

---

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–µ—à–µ–Ω–∏—è

### ‚úÖ **–ß—Ç–æ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ:**

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - background –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑ —É—á–∞—Å—Ç–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. **Event-driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏  
3. **–ü–æ–ª–Ω–∞—è observability** - –¥–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
4. **–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å** - retry –ª–æ–≥–∏–∫–∞ –∏ graceful degradation
5. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –æ–ø–µ—Ä–∞—Ü–∏–π

### üîÆ **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**

**–î–æ —Ä–µ—à–µ–Ω–∏—è:**
- ‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ –∫–æ–≥–¥–∞ NFT –ø–æ—è–≤–∏—Ç—Å—è –≤ –∫–æ—à–µ–ª—å–∫–µ
- ‚ùå –ù–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏  
- ‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–Ω–∞–µ—Ç —Å—Ç–∞—Ç—É—Å–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏

**–ü–æ—Å–ª–µ —Ä–µ—à–µ–Ω–∏—è:**
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** DAS –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
- ‚úÖ **Real-time —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** –æ —Å—Ç–∞—Ç—É—Å–µ  
- ‚úÖ **Webhook –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º
- ‚úÖ **–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç** —Ç–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ NFT

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

### –ï—Å–ª–∏ —Å–∏—Å—Ç–µ–º–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ DAS API –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
```bash
echo $DAS_API_URL
echo $DAS_API_KEY
```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:**
```bash
curl GET /api/mint/monitoring/stats
```

3. **–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞** –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –æ—à–∏–±–æ–∫ DAS –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

4. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ webhook** –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ  
**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–î–∞—Ç–∞:** $(date)

üéâ **–ü—Ä–æ–±–ª–µ–º–∞ #3 –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞!** 